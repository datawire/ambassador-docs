# This file should be placed in the folder for the version of the
# product that's meant to be documented. A `/release-notes` page will
# be automatically generated and populated at build time.
#
# Note that an entry needs to be added to the `doc-links.yml` file in
# order to surface the release notes in the table of contents.
#
# The YAML in this file should contain:
#
# changelog: An (optional) URL to the CHANGELOG for the product.
# items: An array of releases with the following attributes:
#     - version: The (optional) version number of the release, if applicable.
#     - date: The date of the release in the format YYYY-MM-DD.
#     - notes: An array of noteworthy changes included in the release, each having the following attributes:
#         - type: The type of change, one of `bugfix`, `feature`, `security` or `change`.
#         - title: A short title of the noteworthy change.
#         - body: >-
#             Two or three sentences describing the change and why it
#             is noteworthy.  This is HTML, not plain text or
#             markdown.  It is handy to use YAML's ">-" feature to
#             allow line-wrapping.
#         - image: >-
#             The URL of an image that visually represents the
#             noteworthy change.  This path is relative to the
#             `release-notes` directory; if this file is
#             `FOO/releaseNotes.yml`, then the image paths are
#             relative to `FOO/release-notes/`.
#         - docs: The path to the documentation page where additional information can be found.
#         - href: A path from the root to a resource on the getambassador website, takes precedence over a docs link.

docTitle: Telepresence Release Notes
docDescription: >-
  Release notes for Telepresence by Ambassador Labs, a CNCF project
  that enables developers to iterate rapidly on Kubernetes
  microservices by arming them with infinite-scale development
  environments, access to instantaneous feedback loops, and highly
  customizable development environments.

changelog: https://github.com/telepresenceio/telepresence/blob/$branch$/CHANGELOG.md

items:

  - version: 2.15.0 
    date: "2023-08-28"
    notes:
      - type: change
        title: When logging out you will now automatically be disconnected
        body: >-
          With the change of always being required to login for Telepresence commands, you will now be disconnected from
          any existing sessions when logging out.
      - type: feature
        title: Add ASLR to binaries not in docker
        body: >-
          Addresses PEN test issue.
        docs: https://github.com/datawire/telepresence2-proprietary/issues/315
      - type: bugfix
        title: Ensure that the x-telepresence-intercept-id header is read-only.
        body: >-
          The system assumes that the <code>x-telepresence-intercept-id</code> header contains the ID of the intercept
          when it is present, and attempts to redefine it will now result in an error instead of causing a malfunction
          when using preview URLs.
      - type: bugfix
        title: Fix parsing of multiple --http-header arguments
        body: >-
          An intercept using multiple header flags, e.g. <code>--http-header a=b --http-header x=y</code> would assemble
          them incorrectly into one header as <code>--http-header a=b,x=y</code> which were then interpreted as a match
          for the header <code>a</code> with value <code>b,x=y</code>.
      - type: bugfix
        title: Fixed bug in telepresence status when apikey login fails
        body: >-
          A bug was found when the docker-desktop extension would issue a telepresence status command with an expired or invalid apikey. This would 
          cause the extension to get stuck in an authentication loop. This bug was addressed and resolved.
  - version: 2.14.2
    date: "2023-07-26"
    notes:
      - type: feature
        title: Incorporation of the last version of Telepresence.
        body: >-
          A new version of Telepresence OSS was published.
  - version: 2.14.1
    date: "2023-07-07"
    notes:
      - type: feature
        title: More flexible templating in the Intercept Speficiation.
        body: >-
          The <a href="http://masterminds.github.io/sprig/">Sprig</a> template functions can now be used
          in many unconstrained fields of an Intercept Specification, such as environments, arguments, scripts,
          commands, and intercept headers.
      - type: bug
        title: User daemon would panic during connect
        body: >-
          An attempt to connect on a host where no login has ever been made, could cause the user daemon to panic.
  - version: 2.14.0
    date: "2023-06-12"
    notes:
      - type: feature
        title: Telepresence with Docker Compose
        body: >-
          Telepresence now is integrated with Docker Compose. You can now use a compose file as an Intercept Handler in your Intercept Specifcations to utilize you local dev stack alongside an Intercept.
        docs: reference/with-compose
      - type: feature
        title: Added the ability to exclude envrionment variables
        body: >-
          You can now configure your traffic-manager to exclude certain environment variables from being propagated to your local environment while doing an intercept.
        docs: reference/cluster-config#excluding-envrionment-variables
      - type: change
        title: Routing conflict reporting.
        body: >-
          Telepresence will now attempt to detect and report routing conflicts with other running VPN software on client machines.
          There is a new configuration flag that can be tweaked to allow certain CIDRs to be overridden by Telepresence.
        docs: reference/vpn
      - type: change
        title: Migration of Pod Daemon to the proprietary version of Telepresence
        body: >-
          Pod Daemon has been successfully integrated with the most recent proprietary version of Telepresence. This development allows users to leverage the datawire/telepresence image for their deployment previews. This enhancement streamlines the process, improving the efficiency and effectiveness of deployment preview scenarios.
        docs: ci/pod-daemon
          
  - version: 2.13.3
    date: "2023-05-25"
    notes:
      - type: feature
        title: Add imagePullSecrets to hooks
        body: >- 
          Add .Values.hooks.curl.imagePullSecrets and .Values.hooks curl.imagePullSecrets to Helm values.
        docs: https://github.com/telepresenceio/telepresence/pull/3079

      - type: change
        title: Change reinvocation policy to Never for the mutating webhook
        body: >-
          The default setting of the reinvocationPolicy for the mutating webhook dealing with agent injections changed from Never to IfNeeded.

      - type: bugfix
        title: Fix mounting fail of IAM roles for service accounts web identity token
        body: >-
          The eks.amazonaws.com/serviceaccount volume injected by EKS is now exported and remotely mounted during an intercept.
        docs: https://github.com/telepresenceio/telepresence/issues/3166

      - type: bugfix
        title: Correct namespace selector for cluster versions with non-numeric characters
        body: >-
          The mutating webhook now correctly applies the namespace selector even if the cluster version contains non-numeric characters. For example, it can now handle versions such as Major:"1", Minor:"22+".
        docs: https://github.com/telepresenceio/telepresence/pull/3184

      - type: bugfix
        title: Enable IPv6 on the telepresence docker network
        body: >-
          The "telepresence" Docker network will now propagate DNS AAAA queries to the Telepresence DNS resolver when it runs in a Docker container.
        docs: https://github.com/telepresenceio/telepresence/issues/3179

      - type: bugfix
        title: Fix the crash when intercepting with --local-only and --docker-run
        body: >-
          Running telepresence intercept --local-only --docker-run no longer  results in a panic.
        docs: https://github.com/telepresenceio/telepresence/issues/3171

      - type: bugfix
        title: Fix incorrect error message with local-only mounts
        body: >- 
          Running telepresence intercept --local-only --mount false no longer results in an incorrect error message saying "a local-only intercept cannot have mounts".
        docs: https://github.com/telepresenceio/telepresence/issues/3171

      - type: bugfix
        title: specify port in hook urls
        body: >-
          The helm chart now correctly handles custom agentInjector.webhook.port that was not being set in hook URLs.
        docs: https://github.com/telepresenceio/telepresence/pull/3161

      - type: bugfix
        title: Fix wrong default value for disableGlobal and agentArrival
        body: >-
          Params .intercept.disableGlobal and .timeouts.agentArrival are now correctly honored.

  - version: 2.13.2
    date: "2023-05-12"
    notes:
      - type: bugfix
        title: Authenticator Service Update
        body: >-
          Replaced / characters with a - when the authenticator service creates the kubeconfig in the Telepresence cache.
        docs: https://github.com/telepresenceio/telepresence/pull/3167

      - type: bugfix
        title: Enhanced DNS Search Path Configuration for Windows (Auto, PowerShell, and Registry Options)
        body: >-
          Configurable strategy (auto, powershell. or registry) to set the global DNS search path on Windows. Default is auto which means try powershell first, and if it fails, fall back to registry.
        docs: https://github.com/telepresenceio/telepresence/pull/3154

      - type: feature
        title: Configurable Traffic Manager Timeout in values.yaml
        body: >-
          The timeout for the traffic manager to wait for traffic agent to arrive can now be configured in the values.yaml file using timeouts.agentArrival. The default timeout is still 30 seconds.
        docs: https://github.com/telepresenceio/telepresence/pull/3148

      - type: bugfix
        title: Enhanced Local Cluster Discovery for macOS and Windows
        body: >-
          The automatic discovery of a local container based cluster (minikube or kind) used when the Telepresence daemon runs in a container, now works on macOS and Windows, and with different profiles, ports, and cluster names
        docs: https://github.com/telepresenceio/telepresence/pull/3165

      - type: bugfix
        title: FTP Stability Improvements
        body: >-
          Multiple simultaneous intercepts can transfer large files in bidirectionally and in parallel.
        docs: https://github.com/telepresenceio/telepresence/pull/3157

      - type: bugfix
        title: Intercepted Persistent Volume Pods No Longer Cause Timeouts
        body: >-
          Pods using persistent volumes no longer causes timeouts when intercepted.
        docs: https://github.com/telepresenceio/telepresence/pull/3157

      - type: bugfix
        title: Successful 'Telepresence Connect' Regardless of DNS Configuration
        body: >-
          Ensure that `telepresence connect`` succeeds even though DNS isn't configured correctly.
        docs: https://github.com/telepresenceio/telepresence/pull/3154

      - type: bugfix
        title: Traffic-Manager's 'Close of Closed Channel' Panic Issue
        body: >-
          The traffic-manager would sometimes panic with a "close of closed channel" message and exit.
        docs: https://github.com/telepresenceio/telepresence/pull/3160

      - type: bugfix
        title: Traffic-Manager's Type Cast Panic Issue
        body: >-
          The traffic-manager would sometimes panic and exit after some time due to a type cast panic.
        docs: https://github.com/telepresenceio/telepresence/pull/3153

      - type: bugfix
        title: Login Friction
        body: >-
          Improve login behavior by clearing the saved intermediary API Keys when a user logins to force Telepresence to generate new ones.

  - version: 2.13.1
    date: "2023-04-20"
    notes:
      - type: change
        title: Update ambassador-telepresence-agent to version 1.13.13
        body: >-
          The malfunction of the Ambassador Telepresence Agent occurred as a result of an update which compressed the executable file.

  - version: 2.13.0
    date: "2023-04-18"
    notes:
      - type: feature
        title: Better kind / minikube network integration with docker
        body: >-
          The Docker network used by a Kind or Minikube (using the "docker" driver) installation, is automatically detected and connected to a Docker container running the Telepresence daemon.
        docs: https://github.com/telepresenceio/telepresence/pull/3104

      - type: feature
        title: New mapped namespace output
        body: >-
          Mapped namespaces are included in the output of the telepresence status command.

      - type: feature
        title: Setting of the target IP of the intercept
        docs: reference/intercepts/cli
        body: >- 
         There's a new --address flag to the intercept command allowing users to set the target IP of the intercept.
        
      - type: feature
        title: Multi-tenant support
        body: >- 
         The client will no longer need cluster wide permissions when connected to a namespace scoped Traffic Manager.

      - type: bugfix
        title: Cluster domain resolution bugfix
        body: >- 
         The Traffic Manager now uses a fail-proof way to determine the cluster domain.
        docs: https://github.com/telepresenceio/telepresence/issues/3114

      - type: bugfix
        title: Windows DNS
        body: >-
         DNS on windows is more reliable and performant.
        docs: https://github.com/telepresenceio/telepresence/issues/2939

      - type: bugfix
        title: Agent injection with huge amount of deployments
        body: >-
         The agent is now correctly injected even with a high number of deployment starting at the same time.
        docs: https://github.com/telepresenceio/telepresence/issues/3025

      - type: bugfix
        title: Self-contained kubeconfig with Docker
        body: >-
         The kubeconfig is made self-contained before running Telepresence daemon in a Docker container.
        docs: https://github.com/telepresenceio/telepresence/issues/3099

      - type: bugfix
        title: Version command error
        body: >- 
         The version command won't throw an error anymore if there is no kubeconfig file defined.
        docs: https://github.com/telepresenceio/telepresence/issues/3095

      - type: change
        title: Intercept Spec CRD v1alpha1 depreciated
        body: >-
          Please use version v1alpha2 of the intercept spec crd.

  - version: 2.12.2
    date: "2023-04-04"
    notes:
      - type: security
        title: Update Golang build version to 1.20.3
        body: >- 
          Update Golang to 1.20.3 to address CVE-2023-24534, CVE-2023-24536, CVE-2023-24537, and CVE-2023-24538
  - version: 2.12.1
    date: "2023-03-22"
    notes:
      - type: feature
        title: Additions to gather-logs
        body: >- 
          Telepresence now includes the kubeauth logs when running 
          the gather-logs command
      - type: bugfix
        title: Airgapped Clusters can once again create personal intercepts
        body: >-
          Telepresence on airgapped clusters regained the ability to use the
          skipLogin config option to bypass login and create personal intercepts.
      - type: bugfix
        title: Environment Variables are now propagated to kubeauth
        body: >-
          Telepresence now propagates environment variables properly
          to the kubeauth-foreground to be used with cluster authentication
  - version: 2.12.0
    date: "2023-03-20"
    notes:
      - type: feature
        title: Intercept spec can build images from source
        body: >-
          Handlers in the Intercept Specification can now specify a <code>build</code> property instead of an <code>image</code> so that
          the image is built when the spec runs.
        docs: reference/intercepts/specs#build
      - type: feature
        title: Improve volume mount experience for Windows and Mac users
        body: >-
          On macOS and Windows platforms, the installation of sshfs or platform specific FUSE implementations such as macFUSE or WinFSP are
          no longer needed when running an Intercept Specification that uses docker images.
        docs: reference/intercepts/specs
      - type: feature
        title: Check for service connectivity independently from pod connectivity
        body: >-
         Telepresence now enables you to check for a service and pod's connectivity independently, so that it can proxy one without proxying the other.
        docs: https://github.com/telepresenceio/telepresence/issues/2911
      - type: bugfix
        title: Fix cluster authentication when running the telepresence daemon in a docker container.
        body: >-
          Authentication to EKS and GKE clusters have been fixed (k8s >= v1.26)
        docs: https://github.com/telepresenceio/telepresence/pull/3055
      - type: bugfix
        title: The Intercept spec image pattern now allows nested and sha256 images.
        body: >- 
          Telepresence Intercept Specifications now handle passing nested images or the sha256 of an image
        docs: https://github.com/telepresenceio/telepresence/issues/3064
      - type: bugfix
        body: >-
          Telepresence will not longer panic when a CNAME does not contain the .svc in it 
        title: Fix panic when CNAME of kubernetes.default doesn't contain .svc
        docs: https://github.com/telepresenceio/telepresence/issues/3015
  - version: 2.11.1
    date: "2023-02-27"
    notes:
      - type: bugfix
        title: Multiple architectures
        docs: https://github.com/telepresenceio/telepresence/issues/3043
        body: >-
          The multi-arch build for the <code>ambassador-telepresence-manager</code> and <code>ambassador-telepresence-agent</code> now
          works for both amd64 and arm64.
      - type: bugfix
        title: Ambassador agent Helm chart duplicates
        docs: https://github.com/telepresenceio/telepresence/issues/3046
        body: >-
          Some labels in the Helm chart for the Ambassador Agent were duplicated, causing problems for FluxCD.
  - version: 2.11.0
    date: "2023-02-22"
    notes:
      - type: feature
        title: Intercept specification
        body: >-
          It is now possible to leverage the intercept specification to spin up your environment without extra tools.
      - type: feature
        title: Support for arm64 (Apple Silicon)
        body: >-
          The <code>ambassador-telepresence-manager</code> and <code>ambassador-telepresence-agent</code> are now distributed as
          multi-architecture images and can run natively on both linux/amd64 and linux/arm64.
      - type: bugfix
        title: Connectivity check can break routing in VPN setups
        docs: https://github.com/telepresenceio/telepresence/issues/3006
        body: >-
          The connectivity check failed to recognize that the connected peer wasn't a traffic-manager. Consequently,
          it didn't proxy the cluster because it incorrectly assumed that a successful connect meant cluster connectivity,
      - type: bugfix
        title: VPN routes not detected by <code>telepresence test-vpn</code> on macOS
        docs: https://github.com/telepresenceio/telepresence/pull/3038
        body: >-
          The <code>telepresence test-vpn</code> did not include routes of type <code>link</code> when checking for subnet
          conflicts.
  - version: 2.10.5
    date: "2023-02-06"
    notes:
      - type: change
        title: mTLS secrets mount
        body: >-
          mTLS Secrets will now be mounted into the traffic agent, instead of expected to be read by it from the API.
          This is only applicable to users of team mode and the proprietary agent
        docs: reference/cluster-config#tls
      - type: bugfix
        title: Daemon reconnection fix
        body: >-
          Fixed a bug that prevented the local daemons from automatically reconnecting to the traffic manager when the network connection was lost.
  - version: 2.10.4
    date: "2023-01-20"
    notes:
      - type: bugfix
        title: Backward compatibility restored
        body: >-
          Telepresence can now create intercepts with traffic-managers of version 2.9.5 and older.
      - type: bugfix
        title: Saved intercepts now works with preview URLs.
        body: >-
          Preview URLs are now included/excluded correctly when using saved intercepts.
  - version: 2.10.3
    date: "2023-01-17"
    notes:
      - type: bugfix
        title: Saved intercepts
        body: >-
          Fixed an issue which was causing the saved intercepts to not be completely interpreted by telepresence.
      - type: bugfix
        title: Traffic manager restart during upgrade to team mode
        body: >-
          Fixed an issue which was causing the traffic manager to be redeployed after an upgrade to the team mode.
        docs: https://github.com/telepresenceio/telepresence/pull/2979
  - version: 2.10.2
    date: "2023-01-16"
    notes:
      - type: bugfix
        title: version consistency in helm commands
        body: >-
          Ensure that CLI and user-daemon binaries are the same version when running </code>telepresence helm install<code>
          or <code>telepresence helm upgrade</code>.
        docs: https://github.com/telepresenceio/telepresence/pull/2975
      - type: bugfix
        title: Release Process
        body: >-
          Fixed an issue that prevented the <code>--use-saved-intercept</code> flag from working.
  - version: 2.10.1
    date: "2023-01-11"
    notes:
      - type: bugfix
        title: Release Process
        body: >-
          Fixed a regex in our release process that prevented 2.10.0 promotion.
  - version: 2.10.0
    date: "2023-01-11"
    notes:
      - type: feature
        title: Team Mode and Single User Mode
        body: >-
          The Traffic Manager can now be set to either "team" mode or "single user" mode. When in team mode, intercepts will default to http intercepts.
      - type: feature
        title: Added `insert` and `upgrade` Subcommands to `telepresence helm`
        body: >-
          The `telepresence helm` sub-commands `insert` and `upgrade` now accepts all types of helm `--set-XXX` flags.
      - type: feature
        title: Added Image Pull Secrets to Helm Chart
        body: >-
          Image pull secrets for the traffic-agent can now be added using the Helm chart setting `agent.image.pullSecrets`.
      - type: change
        title: Rename Configmap
        body: >-
          The configmap `traffic-manager-clients` has been renamed to `traffic-manager`.
      - type: change
        title: Webhook Namespace Field
        body: >-
          If the cluster is Kubernetes 1.21 or later, the mutating webhook will find the correct namespace using the label `kubernetes.io/metadata.name` rather than `app.kuberenetes.io/name`.
        docs: https://github.com/telepresenceio/telepresence/issues/2913
      - type: change
        title: Rename Webhook
        body: >-
          The name of the mutating webhook now contains the namespace of the traffic-manager so that the webhook is easier to identify when there are multiple namespace scoped telepresence installations in the cluster.
      - type: change
        title: OSS Binaries
        body: >-
          The OSS Helm chart is no longer pushed to the datawire Helm repository. It will instead be pushed from the telepresence proprietary repository. The OSS Helm chart is still what's embedded in the OSS telepresence client.
        docs: https://github.com/telepresenceio/telepresence/pull/2943
      - type: bugfix
        title: Fix Panic Using `--docker-run`
        body: >-
          Telepresence no longer panics when `--docker-run` is combined with `--name <name>` instead of `--name=<name>`.
        docs: https://github.com/telepresenceio/telepresence/issues/2953
      - type: bugfix
        title: Stop assuming cluster domain
        body: >-
          Telepresence traffic-manager extracts the cluster domain (e.g. "cluster.local") using a CNAME lookup for "kubernetes.default" instead of "kubernetes.default.svc".
        docs: https://github.com/telepresenceio/telepresence/pull/2959
      - type: bugfix
        title: Uninstall hook timeout
        body: >-
          A timeout was added to the pre-delete hook `uninstall-agents`, so that a helm uninstall doesn't hang when there is no running traffic-manager.
        docs: https://github.com/telepresenceio/telepresence/pull/2937
      - type: bugfix
        title: Uninstall hook check
        body: >-
          The `Helm.Revision` is now used to prevent that Helm hook calls are served by the wrong revision of the traffic-manager.
        docs: https://github.com/telepresenceio/telepresence/issues/2954
  - version: 2.9.5
    date: "2022-12-08"
    notes:
      - type: security
        title: Update to golang v1.19.4
        body: >-
          Apply security updates by updating to golang v1.19.4
        docs: https://groups.google.com/g/golang-announce/c/L_3rmdT0BMU
      - type: bugfix
        title: GCE authentication
        body: >-
          Fixed a regression, that was introduced in 2.9.3, preventing use of gce authentication without also having a config element present in the gce configuration in the kubeconfig.
  - version: 2.9.4
    date: "2022-12-02"
    notes:
      - type: feature
        title: Subnet detection strategy
        body: >-
          The traffic-manager can automatically detect that the node subnets are different from the pod subnets, and switch detection strategy to instead use subnets that cover the pod IPs.
      - type: bugfix
        title: Fix `--set` flag for `telepresence helm install`
        body: >-
          The `telepresence helm` command `--set x=y` flag didn't correctly set values of other types than `string`. The code now uses standard Helm semantics for this flag.
      - type: bugfix
        title: Fix `agent.image` setting propigation
        body: >-
          Telepresence now uses the correct `agent.image` properties in the Helm chart when copying agent image settings from the `config.yml` file.
      - type: bugfix
        title: Delay file sharing until needed
        body: >-
          Initialization of FTP type file sharing is delayed, so that setting it using the Helm chart value `intercept.useFtp=true` works as expected.
      - type: bugfix
        title: Cleanup on `telepresence quit`
        body: >-
          The port-forward that is created when Telepresence connects to a cluster is now properly closed when `telepresence quit` is called.
      - type: bugfix
        title: Watch `config.yml` without panic
        body: >-
          The user daemon no longer panics when the `config.yml` is modified at a time when the user daemon is running but no session is active.
      - type: bugfix
        title: Thread safety
        body: >-
          Fix race condition that would occur when `telepresence connect` `telepresence leave` was called several times in rapid succession.
  - version: 2.9.3
    date: "2022-11-23"
    notes:
      - type: feature
        title: Helm options for `livenessProbe` and `readinessProbe`
        body: >-
          The helm chart now supports `livenessProbe` and `readinessProbe` for the traffic-manager deployment, so that the pod automatically restarts if it doesn't respond.
      - type: change
        title: Improved network communication
        body: >-
          The root daemon now communicates directly with the traffic-manager instead of routing all outbound traffic through the user daemon.
      - type: bugfix
        title: Root daemon debug logging
        body: >-
          Using `telepresence loglevel LEVEL` now also sets the log level in the root daemon.
      - type: bugfix
        title: Multivalue flag value propagation
        body: >-
          Multi valued kubernetes flags such as `--as-group` are now propagated correctly.
      - type: bugfix
        title: Root daemon stability
        body: >-
          The root daemon would sometimes hang indefinitely when quit and connect were called in rapid succession.
      - type: bugfix
        title: Base DNS resolver
        body: >-
          Don't use `systemd.resolved` base DNS resolver unless cluster is proxied.
  - version: 2.9.2
    date: "2022-11-16"
    notes:
      - type: bugfix
        title: Fix panic
        body: >-
          Fix panic when connecting to an older traffic-manager.
      - type: bugfix
        title: Fix header flag
        body: >-
          Fix an issue where the `http-header` flag sometimes wouldn't propagate correctly.
  - version: 2.9.1
    date: "2022-11-16"
    notes:
      - type: bugfix
        title: Connect failures due to missing auth provider.
        body: >-
          The regression in 2.9.0 that caused a `no Auth Provider found for name “gcp”` error when connecting was fixed.
  - version: 2.9.0
    date: "2022-11-15"
    notes:
      - type: feature
        title: New command to view client configuration.
        body: >-
          A new <code>telepresence config view</code> was added to make it easy to view the current
          client configuration.
        docs: new-in-2.9#view-the-client-configuration
      - type: feature
        title: Configure Clients using the Helm chart.
        body: >-
          The traffic-manager can now configure all clients that connect through the <code>client:</code> map in
          the <code>values.yaml</code> file.
        docs: reference/cluster-config#client-configuration
      - type: feature
        title: The Traffic manager version is more visible.
        body: >-
          The command <code>telepresence version</code> will now include the version of the traffic manager when
          the client is connected to a cluster.
      - type: feature
        title: Command output in YAML format.
        body: >-
          The global <code>--output</code> flag now accepts both <code>yaml</code> and <code>json</code>.
        docs: new-in-2.9#yaml-output
      - type: change
        title: Deprecated status command flag
        body: >-
          The <code>telepresence status --json</code> flag is deprecated. Use <code>telepresence status --output=json</code> instead.
      - type: bugfix
        title: Unqualified service name resolution in docker.
        body: >-
          Unqualified service names now resolves OK from the docker container when using <code>telepresence intercept --docker-run</code>.
        docs: https://github.com/telepresenceio/telepresence/issues/2870
      - type: bugfix
        title: Output no longer mixes plaintext and json.
        body: >-
          Informational messages that don't really originate from the command, such as "Launching Telepresence Root Daemon",
          or "An update of telepresence ...", are discarded instead of being printed as plain text before the actual formatted
          output when using the <code>--output=json</code>.
        docs: https://github.com/telepresenceio/telepresence/issues/2854
      - type: bugfix
        title: No more panic when invalid port names are detected.
        body: >-
          A `telepresence intercept` of services with invalid port no longer causes a panic.
        docs: https://github.com/telepresenceio/telepresence/issues/2880
      - type: bugfix
        title: Proper errors for bad output formats.
        body: >-
          An attempt to use an invalid value for the global <code>--output</code> flag now renders a proper error message.
      - type: bugfix
        title: Remove lingering DNS config on macOS.
        body: >-
          Files lingering under <code>/etc/resolver</code> as a result of ungraceful shutdown of the root daemon on macOS, are
          now removed when a new root daemon starts.
  - version: 2.8.5
    date: "2022-11-2"
    notes:
      - type: security
        title: CVE-2022-41716
        body: >-
          Updated Golang to 1.19.3 to address CVE-2022-41716.
  - version: 2.8.4
    date: "2022-11-2"
    notes:
      - type: bugfix
        title: Release Process
        body: >-
          This release resulted in changes to our release process.
  - version: 2.8.3
    date: "2022-10-27"
    notes:
      - type: feature
        title: Ability to disable global intercepts.
        body: >-
          Global intercepts (a.k.a. TCP intercepts) can now be disabled by using the new Helm chart setting <code>intercept.disableGlobal</code>.
        docs: https://github.com/telepresenceio/telepresence/issues/2140
      - type: feature
        title: Configurable mutating webhook port
        body: >-
          The port used for the mutating webhook can be configured using the Helm chart setting
          <code>agentInjector.webhook.port</code>.
        docs: install/helm
      - type: change
        title: Mutating webhook port defaults to 443
        body: >-
          The default port for the mutating webhook is now <code>443</code>. It used to be <code>8443</code>.
      - type: change
        title: Agent image configuration mandatory in air-gapped environments.
        body: >-
          The traffic-manager will no longer default to use the <code>tel2</code> image for the traffic-agent when it is
          unable to connect to Ambassador Cloud. Air-gapped environments must declare what image to use in the Helm chart.
      - type: bugfix
        title: Can now connect to non-helm installs
        body: >-
          <code>telepresence connect</code> now works as long as the traffic manager is installed, even if
          it wasn't installed via >code>helm install</code>
        docs: https://github.com/telepresenceio/telepresence/issues/2824
      - type: bugfix
        title: check-vpn crash fixed
        body: >-
          telepresence check-vpn no longer crashes when the daemons don't start properly.
  - version: 2.8.2
    date: "2022-10-15"
    notes:
      - type: bugfix
        title: Reinstate 2.8.0
        body: >-
          There was an issue downloading the free enhanced client. This problem was fixed, 2.8.0 was reinstated
  - version: 2.8.1
    date: "2022-10-14"
    notes:
      - type: bugfix
        title: Rollback 2.8.0
        body: >-
          Rollback 2.8.0 while we investigate an issue with ambassador cloud.
  - version: 2.8.0
    date: "2022-10-14"
    notes:
      - type: feature
        title: Improved DNS resolver
        body: >-
          The Telepresence DNS resolver is now capable of resolving queries of type <code>A</code>, <code>AAAA</code>, <code>CNAME</code>,
          <code>MX</code>, <code>NS</code>, <code>PTR</code>, <code>SRV</code>, and <code>TXT</code>.
        docs: reference/dns
      - type: feature
        title: New `client` structure in Helm chart
        body: >-
          A new <code>client</code> struct was added to the Helm chart. It contains a <code>connectionTTL</code> that controls
          how long the traffic manager will retain a client connection without seeing any sign of life from the client.
        docs: reference/cluster-config#Client-Configuration
      - type: feature
        title: Include and exclude suffixes configurable using the Helm chart.
        body: >-
          A dns element was added to the <code>client</code> struct in Helm chart. It contains an <code>includeSuffixes</code> and
          an <code>excludeSuffixes</code> value that controls what type of names that the DNS resolver in the client will delegate to
          the cluster.
        docs: reference/cluster-config#DNS
      - type: feature
        title: Configurable traffic-manager API port
        body: >-
          The API port used by the traffic-manager is now configurable using the Helm chart value <code>apiPort</code>.
          The default port is 8081.
        docs: https://github.com/telepresenceio/telepresence/tree/release/v2/charts/telepresence
      - type: feature
        title: Envoy server and admin port configuration.
        body: >-
          An new <code>agent</code> struct was added to the Helm chart. It contains an `envoy` structure where the server and
          admin port of the Envoy proxy running in the enhanced traffic-agent can be configured.
        docs: reference/cluster-config#Envoy-Configuration
      - type: change
        title: Helm chart `dnsConfig` moved to `client.routing`.
        body: >-
          The Helm chart <code>dnsConfig</code> was deprecated but retained for backward compatibility. The fields <code>alsoProxySubnets</code>
          and <code>neverProxySubnets</code> can now be found under <code>routing</code> in the <code>client</code> struct.
        docs: reference/cluster-config#Routing
      - type: change
        title: Helm chart `agentInjector.agentImage` moved to `agent.image`.
        body: >-
          The Helm chart <code>agentInjector.agentImage</code> was moved to <code>agent.image</code>. The old value is deprecated but
          retained for backward compatibility.
        docs: reference/cluster-config#Image-Configuration
      - type: change
        title: Helm chart `agentInjector.appProtocolStrategy` moved to `agent.appProtocolStrategy`.
        body: >-
          The Helm chart <code>agentInjector.appProtocolStrategy</code> was moved to <code>agent.appProtocolStrategy</code>. The old 
          value is deprecated but retained for backward compatibility.
        docs: reference/cluster-config#Application-Protocol-Selection
      - type: change
        title: Helm chart `dnsServiceName`, `dnsServiceNamespace`, and `dnsServiceIP` removed.
        body: >-
          The Helm chart <code>dnsServiceName</code>, <code>dnsServiceNamespace</code>, and <code>dnsServiceIP</code> has been removed, because
          they are no longer needed. The TUN-device will use the traffic-manager pod-IP on platforms where it needs to
          dedicate an IP for its local resolver.
      - type: change
        title: Quit daemons with `telepresence quit -s`
        body: >-
          The former options `-u` and `-r` for `telepresence quit` has been deprecated and replaced with one option `-s` which will
          quit both the root daemon and the user daemon.
      - type: bugfix
        title: Environment variable interpolation in pods now works.
        body: >-
          Environment variable interpolation now works for all definitions that are copied from pod containers
          into the injected traffic-agent container.
      - type: bugfix
        title: Early detection of namespace conflict
        body: >-
          An attempt to create simultaneous intercepts that span multiple namespace on the same workstation
          is detected early and prohibited instead of resulting in failing DNS lookups later on.
      - type: bugfix
        title: Annoying log message removed
        body: >-
          Spurious and incorrect ""!! SRV xxx"" messages will no longer appear in the logs when the reason
          is normal context cancellation.
      - type: bugfix
        title: Single name DNS resolution in Docker on Linux host
        body: >-
          Single label names now resolves correctly when using Telepresence in Docker on a Linux host
      - type: bugfix
        title: Misnomer `appPortStrategy` in Helm chart renamed to `appProtocolStrategy`.
        body: >-
          The Helm chart value <code>appProtocolStrategy</code> is now correctly named (used to be <code>appPortStategy</code>)
  - version: 2.7.6
    date: "2022-09-16"
    notes:
      - type: feature
        title: Helm chart resource entries for injected agents
        body: >-
          The <code>resources</code> for the traffic-agent container and the optional init container can be
          specified in the Helm chart using the <code>resources</code> and <code>initResource</code> fields
          of the <code>agentInjector.agentImage<code>
      - type: feature
        title: Cluster event propagation when injection fails
        body: >-
          When the traffic-manager fails to inject a traffic-agent, the cause for the failure is
          detected by reading the cluster events, and propagated to the user.
      - type: feature
        title: FTP-client instead of sshfs for remote mounts
        body: >-
          Telepresence can now use an embedded FTP client and load an existing FUSE library instead of running
          an external <code>sshfs</code> or <code>sshfs-win</code> binary. This feature is experimental in 2.7.x
          and enabled by setting <code>intercept.useFtp</code> to <code>true</code>> in the <code>config.yml</code>.
      - type: change
        title: Upgrade of winfsp
        body: >-
          Telepresence on Windows upgraded <code>winfsp</code> from version 1.10 to 1.11
      - type: bugfix
        title: Removal of invalid warning messages
        body: >-
          Running CLI commands on Apple M1 machines will no longer throw warnings about <code>/proc/cpuinfo</code>
          and <code>/proc/self/auxv</code>.
  - version: 2.7.5
    date: "2022-09-14"
    notes:
      - type: change
        title: Rollback of release 2.7.4
        body: >-
          This release is a rollback of the changes in 2.7.4, so essentially the same as 2.7.3
  - version: 2.7.4
    date: "2022-09-14"
    notes:
      - type: change
        body: >-
          This release was broken on some platforms. Use 2.7.6 instead.
  - version: 2.7.3
    date: "2022-09-07"
    notes:
      - type: bugfix
        title: PTY for CLI commands
        body: >-
          CLI commands that are executed by the user daemon now use a pseudo TTY. This enables
          <code>docker run -it</code> to allocate a TTY and will also give other commands like <code>bash read</code> the
          same behavior as when executed directly in a terminal.
        docs: https://github.com/telepresenceio/telepresence/issues/2724
      - type: bugfix
        title: Traffic Manager useless warning silenced
        body: >-
          The traffic-manager will no longer log numerous warnings saying <code>Issuing a 
          systema request without ApiKey or InstallID may result in an error</code>.
      - type: bugfix
        title: Traffic Manager useless error silenced
        body: >-
          The traffic-manager will no longer log an error saying <code>Unable to derive subnets
          from nodes</code> when the <code>podCIDRStrategy</code> is <code>auto</code> and it chooses to instead derive the
          subnets from the pod IPs.
  - version: 2.7.2
    date: "2022-08-25"
    notes:
      - type: feature
        title: Autocompletion scripts
        body: >-
          Autocompletion scripts can now be generated with <code>telepresence completion SHELL</code> where <code>SHELL</code> can be <code>bash, zsh, fish</code> or <code>powershell</code>.
      - type: feature
        title: Connectivity check timeout
        body: >-
          The timeout for the initial connectivity check that Telepresence performs
          in order to determine if the cluster's subnets are proxied or not can now be configured
          in the <code>config.yml</code> file using <code>timeouts.connectivityCheck</code>. The default timeout was
          changed from 5 seconds to 500 milliseconds to speed up the actual connect.
        docs: reference/config#timeouts
      - type: change
        title: gather-traces feedback
        body: >-
          The command <code>telepresence gather-traces</code> now prints out a message on success.
        docs: troubleshooting#distributed-tracing
      - type: change
        title: upload-traces feedback
        body: >-
          The command <code>telepresence upload-traces</code> now prints out a message on success.
        docs: troubleshooting#distributed-tracing
      - type: change
        title: gather-traces tracing
        body: >-
          The command <code>telepresence gather-traces</code> now traces itself and reports errors with trace gathering.
        docs: troubleshooting#distributed-tracing
      - type: change
        title: CLI log level
        body: >-
          The <code>cli.log</code> log is now logged at the same level as the <code>connector.log</code>
        docs: reference/config#log-levels
      - type: bugfix
        title: Telepresence --help fixed
        body: >-
          <code>telepresence --help</code> now works once more even if there's no user daemon running.
        docs: https://github.com/telepresenceio/telepresence/issues/2735
      - type: bugfix
        title: Stream cancellation when no process intercepts
        body: >-
          Streams created between the traffic-agent and the workstation are now properly closed
          when no interceptor process has been started on the workstation. This fixes a potential problem where
          a large number of attempts to connect to a non-existing interceptor would cause stream congestion
          and an unresponsive intercept.
      - type: bugfix
        title: List command excludes the traffic-manager
        body: >-
          The <code>telepresence list</code> command no longer includes the <code>traffic-manager</code> deployment.
  - version: 2.7.1
    date: "2022-08-10"
    notes:
      - type: change
        title: Reinstate telepresence uninstall
        body: >-
          Reinstate <code>telepresence uninstall</code> with <code>--everything</code> depreciated
      - type: change
        title: Reduce telepresence helm uninstall
        body: >-
          <code>telepresence helm uninstall</code> will only uninstall the traffic-manager helm chart and no longer accepts the <code>--everything</code>, <code>--agent</code>, or <code>--all-agents</code> flags.
      - type: bugfix
        title: Auto-connect for telepresence intercpet
        body: >-
          <code>telepresence intercept</code> will attempt to connect to the traffic manager before creating an intercept.
  - version: 2.7.0
    date: "2022-08-07"
    notes:
      - type: feature
        title: Saved Intercepts
        body: >-
          Create telepresence intercepts based on existing Saved Intercepts configurations with <code>telepresence intercept --use-saved-intercept $SAVED_INTERCEPT_NAME</code>
        docs: reference/intercepts#sharing-intercepts-with-teammates
      - type: feature
        title: Distributed Tracing
        body: >-
          The Telepresence components now collect OpenTelemetry traces.
          Up to 10MB of trace data are available at any given time for collection from
          components. <code>telepresence gather-traces</code> is a new command that will collect
          all that data and place it into a gzip file, and <code>telepresence upload-traces</code> is
          a new command that will push the gzipped data into an OTLP collector.
        docs: troubleshooting#distributed-tracing
      - type: feature
        title: Helm install
        body: >-
          A new <code>telepresence helm</code> command was added to provide an easy way to install, upgrade, or uninstall the telepresence traffic-manager.
        docs: install/manager
      - type: feature
        title: Ignore Volume Mounts
        body: >-
          The agent injector now supports a new annotation, <code>telepresence.getambassador.io/inject-ignore-volume-mounts</code>, that can be used to make the injector ignore specified volume mounts denoted by a comma-separated string.
      - type: feature
        title: telepresence pod-daemon
        body: >-
          The Docker image now contains a new program in addition to
          the existing traffic-manager and traffic-agent: the pod-daemon. The
          pod-daemon is a trimmed-down version of the user-daemon that is
          designed to run as a sidecar in a Pod, enabling CI systems to create
          preview deploys.
      - type: feature
        title: Prometheus support for traffic manager
        body: >-
          Added prometheus support to the traffic manager.
      - type: change
        title: No install on telepresence connect
        body: >-
          The traffic manager is no longer automatically installed into the cluster. Connecting or creating an intercept in a cluster without a traffic manager will return an error.
        docs: install/manager
      - type: change
        title: Helm Uninstall
        body: >-
          The command <code>telepresence uninstall</code> has been moved to <code>telepresence helm uninstall</code>.
        docs: install/manager
      - type: bugfix
        title: readOnlyRootFileSystem mounts work
        body: >-
          Add an emptyDir volume and volume mount under <code>/tmp</code> on the agent sidecar so it works with `readOnlyRootFileSystem: true`
        docs: https://github.com/telepresenceio/telepresence/pull/2666
  - version: 2.6.8
    date: "2022-06-23"
    notes:
      - type: feature
        title: Specify Your DNS
        body: >-
          The name and namespace for the DNS Service that the traffic-manager uses in DNS auto-detection can now be specified.
      - type: feature
        title: Specify a Fallback DNS
        body: >-
          Should the DNS auto-detection logic in the traffic-manager fail, users can now specify a fallback IP to use.
      - type: feature
        title: Intercept UDP Ports
        body: >-
          It is now possible to intercept UDP ports with Telepresence and also use <code>--to-pod</code> to forward UDP traffic from ports on localhost.
      - type: change
        title: Additional Helm Values
        body: >-
          The Helm chart will now add the <code>nodeSelector</code>, <code>affinity</code> and <code>tolerations</code> values to the traffic-manager's post-upgrade-hook and pre-delete-hook jobs.
      - type: bugfix
        title: Agent Injection Bugfix
        body: >-
          Telepresence no longer fails to inject the traffic agent into the pod generated for workloads that have no volumes and `automountServiceAccountToken: false`.
  - version: 2.6.7
    date: "2022-06-22"
    notes:
      - type: bugfix
        title: Persistant Sessions
        body: >-
          The Telepresence client will remember and reuse the traffic-manager session after a network failure or other reason that caused an unclean disconnect.
      - type: bugfix
        title: DNS Requests
        body: >-
          Telepresence will no longer forward DNS requests for "wpad" to the cluster.
      - type: bugfix
        title: Graceful Shutdown
        body: >-
          The traffic-agent will properly shut down if one of its goroutines errors.
  - version: 2.6.6
    date: "2022-06-9"
    notes:
      - type: bugfix
        title: Env Var `TELEPRESENCE_API_PORT`
        body: >-
          The propagation of the <code>TELEPRESENCE_API_PORT</code> environment variable now works correctly.
      - type: bugfix
        title: Double Printing `--output json`
        body: >-
          The <code>--output json</code> global flag no longer outputs multiple objects
  - version: 2.6.5
    date: "2022-06-03"
    notes:
      - type: feature
        title: Helm Option -- `reinvocationPolicy`
        body: >-
          The <code>reinvocationPolicy</code> or the traffic-agent injector webhook can now be configured using the Helm chart.
        docs: install/helm
      - type: feature
        title: Helm Option -- Proxy Certificate
        body: >-
          The traffic manager now accepts a root CA for a proxy, allowing it to connect to ambassador cloud from behind an HTTPS proxy. This can be configured through the helm chart.
        docs: install/helm
      - type: feature
        title: Helm Option -- Agent Injection
        body: >-
          A policy that controls when the mutating webhook injects the traffic-agent was added, and can be configured in the Helm chart.
        docs: install/helm
      - type: change
        title: Windows Tunnel Version Upgrade
        body: >-
          Telepresence on Windows upgraded wintun.dll from version 0.12 to version 0.14.1
      - type: change
        title: Helm Version Upgrade
        body: >-
          Telepresence upgraded its embedded Helm from version 3.8.1 to 3.9
      - type: change
        title: Kubernetes API Version Upgrade
        body: >-
          Telepresence upgraded its embedded Kubernetes API from version 0.23.4 to 0.24.1
      - type: feature
        title: Flag `--watch` Added to `list` Command
        body: >-
          Added a <code>--watch</code> flag to <code>telepresence list</code> that can be used to watch interceptable workloads in a namespace.
      - type: change
        title: Depreciated `images.webhookAgentImage`
        body: >-
          The Telepresence configuration setting for `images.webhookAgentImage` is now deprecated. Use `images.agentImage` instead.
      - type: bugfix
        title: Default `reinvocationPolicy` Set to Never
        body: >-
          The <code>reinvocationPolicy</code> or the traffic-agent injector webhook now defaults to <code>Never</code> insteadof <code>IfNeeded</code> so that <code>LimitRange</code>s on namespaces can inject a missing <code>resources</code> element into the injected traffic-agent container.
      - type: bugfix
        title: UDP
        body: >-
          UDP based communication with services in the cluster now works as expected.
      - type: bugfix
        title: Telepresence `--help`
        body: >-
          The command help will only show Kubernetes flags on the commands that supports them
      - type: change
        title: Error Count
        body: >-
          Only the errors from the last session will be considered when counting the number of errors in the log after a command failure.
  - version: 2.6.4
    date: "2022-05-23"
    notes:
      - type: bugfix
        title: Upgrade RBAC Permissions
        body: >-
          The traffic-manager RBAC grants permissions to update services, deployments, replicatsets, and statefulsets. Those permissions are needed when the traffic-manager upgrades from versions < 2.6.0 and can be revoked after the upgrade.
  - version: 2.6.3
    date: "2022-05-20"
    notes:
      - type: bugfix
        title: Relative Mount Paths
        body: >-
          The <code>--mount</code> intercept flag now handles relative mount points correctly on non-windows platforms. Windows still require the argument to be a drive letter followed by a colon.
      - type: bugfix
        title: Traffic Agent Config
        body: >-
          The traffic-agent's configuration update automatically when services are added, updated or deleted.
      - type: bugfix
        title: Container Injection for Numeric Ports
        body: >-
          Telepresence will now always inject an initContainer when the service's targetPort is numeric
      - type: bugfix
        title: Matching Services
        body: >-
          Workloads that have several matching services pointing to the same target port are now handled correctly.
      - type: bugfix
        title: Unexpected Panic
        body: >-
          A potential race condition causing a panic when closing a DNS connection is now handled correctly.
      - type: bugfix
        title: Mount Volume Cleanup
        body: >-
          A container start would sometimes fail because and old directory remained in a mounted temp volume.
  - version: 2.6.2
    date: "2022-05-17"
    notes:
      - type: bugfix
        title: Argo Injection
        body: >-
          Workloads controlled by workloads like Argo <code>Rollout</code> are injected correctly.
      - type: bugfix
        title: Agent Port Mapping
        body: >-
          Multiple services appointing the same container port no longer result in duplicated ports in an injected pod.
      - type: bugfix
        title: GRPC Max Message Size
        body: >-
          The <code>telepresence list</code> command no longer errors out with "grpc: received message larger than max" when listing namespaces with a large number of workloads.
  - version: 2.6.1
    date: "2022-05-16"
    notes:
      - type: bugfix
        title: KUBECONFIG environment variable
        body: >-
          Telepresence will now handle multiple path entries in the KUBECONFIG environment correctly.
      - type: bugfix
        title: Don't Panic
        body: >-
          Telepresence will no longer panic when using preview URLs with traffic-managers < 2.6.0
  - version: 2.6.0
    date: "2022-05-13"
    notes:
      - type: feature
        title: Intercept multiple containers in a pod, and multiple ports per container
        body: >-
          Telepresence can now intercept multiple services and/or service-ports that connect to the same pod.
        docs: new-in-2.6#intercept-multiple-containers-and-ports
      - type: feature
        title: The Traffic Agent sidecar is always injected by the Traffic Manager's mutating webhook
        body: >-
          The client will no longer modify <code>deployments</code>, <code>replicasets</code>, or <code>statefulsets</code> in order to
          inject a Traffic Agent into an intercepted pod. Instead, all injection is now performed by a mutating webhook. As a result,
          the client now needs less permissions in the cluster.
        docs: install/upgrade#important-note-about-upgrading-to-2.6.0
      - type: change
        title: Automatic upgrade of Traffic Agents
        body: >-
          When upgrading, all workloads with injected agents will have their agent "uninstalled" automatically.
          The mutating webhook will then ensure that their pods will receive an updated Traffic Agent.
        docs: new-in-2.6#no-more-workload-modifications
      - type: change
        title: No default image in the Helm chart
        body: >-
          The helm chart no longer has a default set for the <code>agentInjector.image.name<code>, and unless it's set, the
          traffic-manager will ask Ambassador Could for the preferred image.
        docs: new-in-2.6#smarter-agent
      - type: change
        title: Upgrade to Helm version 3.8.1
        body: The Telepresence client now uses Helm version 3.8.1 when auto-installing the Traffic Manager.
      - type: bugfix
        title: Remote mounts will now function correctly with custom securityContext
        body: >-
          The bug causing permission problems when the Traffic Agent is in a Pod with a custom <code>securityContext</code> has been fixed.
      - type: bugfix
        title: Improved presentation of flags in CLI help
        body: The help for commands that accept Kubernetes flags will now display those flags in a separate group.
      - type: bugfix
        title: Better termination of process parented by intercept
        body: >-
          Occasionally an intercept will spawn a command using <code>--</code> on the command line, often in another console.
          When you use <code>telepresence leave</code> or <code>telepresence quit</code> while the intercept with the spawned command is still active,
          Telepresence will now terminate that the command because it's considered to be parented by the intercept that is being removed.
  - version: 2.5.8
    date: "2022-04-27"
    notes:
      - type: bugfix
        title: Folder creation on `telepresence login`
        body: >-
          Fixed a bug where the telepresence config folder would not be created if the user ran <code>telepresence login</code> before other commands.
  - version: 2.5.7
    date: "2022-04-25"
    notes:
      - type: change
        title: RBAC requirements
        body: >-
          A namespaced traffic-manager will no longer require cluster wide RBAC. Only Roles and RoleBindings are now used.
      - type: bugfix
        title: Windows DNS
        body: >-
          The DNS recursion detector didn't work correctly on Windows, resulting in sporadic failures to resolve names that were resolved correctly at other times.
      - type: bugfix
        title: Session TTL and Reconnect
        body: >-
          A telepresence session will now last for 24 hours after the user's last connectivity. If a session expires, the connector will automatically try to reconnect.
  - version: 2.5.6
    date: "2022-04-18"
    notes:
      - type: change
        title: Less Watchers
        body: >-
          Telepresence agents watcher will now only watch namespaces that the user has accessed since the last <code>connect</code>.
      - type: bugfix
        title: More Efficient `gather-logs`
        body: >-
          The <code>gather-logs</code> command will no longer send any logs through <code>gRPC</code>.
  - version: 2.5.5
    date: "2022-04-08"
    notes:
      - type: change
        title: Traffic Manager Permissions
        body: >-
          The traffic-manager now requires permissions to read pods across namespaces even if installed with limited permissions
      - type: bugfix
        title: Linux DNS Cache
        body: >-
          The DNS resolver used on Linux with systemd-resolved now flushes the cache when the search path changes.
      - type: bugfix
        title: Automatic Connect Sync
        body: >-
          The <code>telepresence list</code> command will produce a correct listing even when not preceded by a <code>telepresence connect</code>.
      - type: bugfix
        title: Disconnect Reconnect Stability
        body: >-
          The root daemon will no longer get into a bad state when a disconnect is rapidly followed by a new connect.
      - type: bugfix
        title: Limit Watched Namespaces
        body: >-
          The client will now only watch agents from accessible namespaces, and is also constrained to namespaces explicitly mapped using the <code>connect</code> command's <code>--mapped-namespaces</code> flag.
      - type: bugfix
        title: Limit Namespaces used in `gather-logs`
        body: >-
          The <code>gather-logs</code> command will only gather traffic-agent logs from accessible namespaces, and is also constrained to namespaces explicitly mapped using the <code>connect</code> command's <code>--mapped-namespaces</code> flag.
  - version: 2.5.4
    date: "2022-03-29"
    notes:
      - type: bugfix
        title: Linux DNS Concurrency
        body: >-
          The DNS fallback resolver on Linux now correctly handles concurrent requests without timing them out
      - type: bugfix
        title: Non-Functional Flag
        body: >-
          The ingress-l5 flag will no longer be forcefully set to equal the --ingress-host flag
      - type: bugfix
        title: Automatically Remove Failed Intercepts
        body: >-
          Intercepts that fail to create are now consistently removed to prevent non-working dangling intercepts from sticking around.
      - type: bugfix
        title: Agent UID
        body: >-
          Agent container is no longer sensitive to a random UID or an UID imposed by a SecurityContext.
      - type: bugfix
        title: Gather-Logs Output Filepath
        body: >-
          Removed a bad concatenation that corrupted the output path of <code>telepresence gather-logs</code>.
      - type: change
        title: Remove Unnecessary Error Advice
        body: >-
          An advice to "see logs for details" is no longer printed when the argument count is incorrect in a CLI command.
      - type: bugfix
        title: Garbage Collection
        body: >-
          Client and agent sessions no longer leaves dangling waiters in the traffic-manager when they depart.
      - type: bugfix
        title: Limit Gathered Logs
        body: >-
          The client's gather logs command and agent watcher will now respect the configured grpc.maxReceiveSize
      - type: change
        title: In-Cluster Checks
        body: >-
          The TUN device will no longer route pod or service subnets if it is running in a machine that's already connected to the cluster
      - type: change
        title: Expanded Status Command
        body: >-
          The status command includes the install id, user id, account id, and user email in its result, and can print output as JSON
      - type: change
        title: List Command Shows All Intercepts
        body: >-
          The list command, when used with the <code>--intercepts</code> flag, will list the users intercepts from all namespaces
  - version: 2.5.3
    date: "2022-02-25"
    notes:
      - type: bugfix
        title: TCP Connectivity
        body: >-
          Fixed bug in the TCP stack causing timeouts after repeated connects to the same address
      - type: feature
        title: Linux Binaries
        body: >-
          Client-side binaries for the arm64 architecture are now available for linux
  - version: 2.5.2
    date: "2022-02-23"
    notes:
      - type: bugfix
        title: DNS server bugfix
        body: >-
          Fixed a bug where Telepresence would use the last server in resolv.conf
  - version: 2.5.1
    date: "2022-02-19"
    notes:
      - type: bugfix
        title: Fix GKE auth issue
        body: >-
          Fixed a bug where using a GKE cluster would error with: No Auth Provider found for name "gcp"
  - version: 2.5.0
    date: "2022-02-18"
    notes:
      - type: feature
        title: Intercept specific endpoints
        body: >-
          The flags <code>--http-path-equal</code>, <code>--http-path-prefix</code>, and <code>--http-path-regex</code> can can be used in
          addition to the <code>--http-match</code> flag to filter personal intercepts by the request URL path
        docs: concepts/intercepts#intercepting-a-specific-endpoint
      - type: feature
        title: Intercept metadata
        body: >-
          The flag <code>--http-meta</code> can be used to declare metadata key value pairs that will be returned by the Telepresence rest
          API endpoint <code>/intercept-info</code>
        docs: reference/restapi#intercept-info
      - type: change
        title: Client RBAC watch
        body: >-
          The verb "watch" was added to the set of required verbs when accessing services and workloads for the client RBAC
          <code>ClusterRole</code>
        docs: reference/rbac
      - type: change
        title: Dropped backward compatibility with versions <=2.4.4
        body: >-
          Telepresence is no longer backward compatible with versions 2.4.4 or older because the deprecated multiplexing tunnel
          functionality was removed.
      - type: change
        title: No global networking flags
        body: >-
          The global networking flags are no longer used and using them will render a deprecation warning unless they are supported by the
          command. The subcommands that support networking flags are <code>connect</code>, <code>current-cluster-id</code>,
          and <code>genyaml</code>.
      - type: bugfix
        title: Output of status command
        body: >-
          The <code>also-proxy</code> and <code>never-proxy</code> subnets are now displayed correctly when using the
          <code>telepresence status</code> command.
      - type: bugfix
        title: SETENV sudo privilege no longer needed
        body: >-
          Telepresence longer requires <code>SETENV</code> privileges when starting the root daemon.
      - type: bugfix
        title: Network device names containing dash
        body: >-
          Telepresence will now parse device names containing dashes correctly when determining routes that it should never block.
      - type: bugfix
        title: Linux uses cluster.local as domain instead of search
        body: >-
          The cluster domain (typically "cluster.local") is no longer added to the DNS <code>search</code> on Linux using
          <code>systemd-resolved</code>. Instead, it is added as a <code>domain</code> so that names ending with it are routed
          to the DNS server.
  - version: 2.4.11
    date: "2022-02-10"
    notes:
      - type: change
        title: Add additional logging to troubleshoot intermittent issues with intercepts
        body: >-
          We've noticed some issues with intercepts in v2.4.10, so we are releasing a version
          with enhanced logging to help debug and fix the issue.
  - version: 2.4.10
    date: "2022-01-13"
    notes:
      - type: feature
        title: Application Protocol Strategy
        body: >-
          The strategy used when selecting the application protocol for personal intercepts can now be configured using
          the <code>intercept.appProtocolStrategy</code> in the <code>config.yml</code> file.
        docs: reference/config/#intercept
        image: telepresence-2.4.10-intercept-config.png
      - type: feature
        title: Helm value for the Application Protocol Strategy
        body: >-
          The strategy when selecting the application protocol for personal intercepts in agents injected by the
          mutating webhook can now be configured using the <code>agentInjector.appProtocolStrategy</code> in the Helm chart.
        docs: install/helm
      - type: feature
        title: New --http-plaintext option
        body: >-
          The flag <code>--http-plaintext</code> can be used to ensure that an intercept uses plaintext http or grpc when
          communicating with the workstation process.
        docs: reference/intercepts/#tls
      - type: feature
        title: Configure the default intercept port
        body: >-
          The port used by default in the <code>telepresence intercept</code> command (8080), can now be changed by setting
          the <code>intercept.defaultPort</code> in the <code>config.yml</code> file.
        docs: reference/config/#intercept
      - type: change
        title: Telepresence CI now uses Github Actions
        body: >-
          Telepresence now uses Github Actions for doing unit and integration testing. It is
          now easier for contributors to run tests on PRs since maintainers can add an
          "ok to test" label to PRs (including from forks) to run integration tests.
        docs: https://github.com/telepresenceio/telepresence/actions
        image: telepresence-2.4.10-actions.png
      - type: bugfix
        title: Check conditions before asking questions
        body: >-
          User will not be asked to log in or add ingress information when creating an intercept until a check has been
          made that the intercept is possible.
        docs: reference/intercepts/
      - type: bugfix
        title: Fix invalid log statement
        body: >-
          Telepresence will no longer log invalid: <code>"unhandled connection control message: code DIAL_OK"</code> errors.
      - type: bugfix
        title: Log errors from sshfs/sftp
        body: >-
          Output to <code>stderr</code> from the traffic-agent's <code>sftp</code> and the client's <code>sshfs</code> processes
          are properly logged as errors.
      - type: bugfix
        title: Don't use Windows path separators in workload pod template
        body: >-
          Auto installer will no longer not emit backslash separators for the <code>/tel-app-mounts</code> paths in the
          traffic-agent container spec when running on Windows.
  - version: 2.4.9
    date: "2021-12-09"
    notes:
      - type: bugfix
        title: Helm upgrade nil pointer error
        body: >-
          A helm upgrade using the <code>--reuse-values</code> flag no longer fails on a "nil pointer" error caused by a nil
          <code>telpresenceAPI</code> value.
        docs: install/helm#upgrading-the-traffic-manager
  - version: 2.4.8
    date: "2021-12-03"
    notes:
      - type: feature
        title: VPN diagnostics tool
        body: >-
          There is a new subcommand, <code>test-vpn</code>, that can be used to diagnose connectivity issues with a VPN.
          See the VPN docs for more information on how to use it.
        docs: reference/vpn
        image: telepresence-2.4.8-vpn.png

      - type: feature
        title: RESTful API service
        body: >-
          A RESTful service was added to Telepresence, both locally to the client and to the <code>traffic-agent</code> to
          help determine if messages with a set of headers should be consumed or not from a message queue where the
          intercept headers are added to the messages.
        docs: reference/restapi
        image: telepresence-2.4.8-health-check.png

      - type: change
        title: TELEPRESENCE_LOGIN_CLIENT_ID env variable no longer used
        body: >-
          You could previously configure this value, but there was no reason to change it, so the value
          was removed.

      - type: bugfix
        title: Tunneled network connections behave more like ordinary TCP connections.
        body: >-
          When using Telepresence with an external cloud provider for extensions, those tunneled
          connections now behave more like TCP connections, especially when it comes to timeouts.
          We've also added increased testing around these types of connections.
  - version: 2.4.7
    date: "2021-11-24"
    notes:
      - type: feature
        title: Injector service-name annotation
        body: >-
          The agent injector now supports a new annotation, <code>telepresence.getambassador.io/inject-service-name</code>, that can be used to set the name of the service to be intercepted.
          This will help disambiguate which service to intercept for when a workload is exposed by multiple services, such as can happen with Argo Rollouts
        docs: reference/cluster-config#service-name-annotation
      - type: feature
        title: Skip the Ingress Dialogue
        body: >-
          You can now skip the ingress dialogue by setting the ingress parameters in the corresponding flags.
        docs: reference/intercepts#skipping-the-ingress-dialogue
      - type: feature
        title: Never proxy subnets
        body: >-
          The kubeconfig extensions now support a <code>never-proxy</code> argument,
          analogous to <code>also-proxy</code>, that defines a set of subnets that
          will never be proxied via telepresence.
        docs: reference/config#neverproxy
      - type: change
        title: Daemon versions check
        body: >-
          Telepresence now checks the versions of the client and the daemons and asks the user to quit and restart if they don't match.
      - type: change
        title: No explicit DNS flushes
        body: >-
          Telepresence DNS now uses a very short TTL instead of explicitly flushing DNS by killing the <code>mDNSResponder</code> or doing <code>resolvectl flush-caches</code>
        docs: reference/routing#dns-caching
      - type: bugfix
        title: Legacy flags now work with global flags
        body: >-
          Legacy flags such as <code>--swap-deployment</code> can now be used together with global flags.
      - type: bugfix
        title: Outbound connection closing
        body: >-
          Outbound connections are now properly closed when the peer closes.
      - type: bugfix
        title: Prevent DNS recursion
        body: >-
          The DNS-resolver will trap recursive resolution attempts (may happen when the cluster runs in a docker-container on the client).
        docs: reference/routing#dns-recursion
      - type: bugfix
        title: Prevent network recursion
        body: >-
          The TUN-device will trap failed connection attempts that results in recursive calls back into the TUN-device (may happen when the
          cluster runs in a docker-container on the client).
        docs: reference/routing#connect-recursion
      - type: bugfix
        title: Traffic Manager deadlock fix
        body: >-
          The Traffic Manager no longer runs a risk of entering a deadlock when a new Traffic agent arrives.
      - type: bugfix
        title: webhookRegistry config propagation
        body: >-
          The configured <code>webhookRegistry</code> is now propagated to the webhook installer even if no <code>webhookAgentImage</code> has been set.
        docs: reference/config#images
      - type: bugfix
        title: Login refreshes expired tokens
        body: >-
          When a user's token has expired, <code> telepresence login </code>
          will prompt the user to log in again to get a new token. Previously,
          the user had to <code> telepresence quit </code> and <code> telepresence logout </code>
          to get a new token.
        docs: https://github.com/telepresenceio/telepresence/issues/2062
  - version: 2.4.6
    date: "2021-11-02"
    notes:
      - type: feature
        title: Manually injecting Traffic Agent
        body: >-
          Telepresence now supports manually injecting the traffic-agent YAML into workload manifests.
          Use the <code>genyaml</code> command to create the sidecar YAML, then add the <code>telepresence.getambassador.io/manually-injected: "true"</code> annotation to your pods to allow Telepresence to intercept them.
        docs: reference/intercepts/manual-agent

      - type: feature
        title: Telepresence CLI released for Apple silicon
        body: >-
          Telepresence is now built and released for Apple silicon.
        docs: install/?os=macos

      - type: change
        title: Telepresence help text now links to telepresence.io
        body: >-
          We now include a link to our documentation when you run <code>telepresence --help</code>. This will make it easier
          for users to find this page whether they acquire Telepresence through Brew or some other mechanism.
        image: telepresence-2.4.6-help-text.png

      - type: bugfix
        title: Fixed bug when API server is inside CIDR range of pods/services
        body: >-
          If the API server for your kubernetes cluster had an IP that fell within the
          subnet generated from pods/services in a kubernetes cluster, it would proxy traffic
          to the API server which would result in hanging or a failed connection. We now ensure
          that the API server is explicitly not proxied.
  - version: 2.4.5
    date: "2021-10-15"
    notes:
      - type: feature
        title: Get pod yaml with gather-logs command
        body: >-
          Adding the flag <code>--get-pod-yaml</code> to your request will get the
          pod yaml manifest for all kubernetes components you are getting logs for
          (<code> traffic-manager</code> and/or pods containing a <code>
          traffic-agent</code> container).  This flag is set to <code>false</code>
          by default.
        docs: reference/client
        image: telepresence-2.4.5-pod-yaml.png

      - type: feature
        title: Anonymize pod name + namespace when using gather-logs command
        body: >-
          Adding the flag <code>--anonymize</code> to your command will
          anonymize your pod names + namespaces in the output file.  We replace the
          sensitive names with simple names (e.g. pod-1, namespace-2) to maintain
          relationships between the objects without exposing the real names of your
          objects. This flag is set to <code>false</code> by default.
        docs: reference/client
        image: telepresence-2.4.5-logs-anonymize.png

      - type: feature
        title: Added context and defaults to ingress questions when creating a preview URL
        body: >-
          Previously, we referred to OSI model layers when asking these questions, but this
          terminology is not commonly used. The questions now provide a clearer context for the user, along with a default answer as an example.
        docs: howtos/preview-urls
        image: telepresence-2.4.5-preview-url-questions.png

      - type: feature
        title: Support for intercepting headless services
        body: >-
          Intercepting headless services is now officially supported.  You can request a
          headless service on whatever port it exposes and get a response from the
          intercept. This leverages the same approach as intercepting numeric ports when
          using the mutating webhook injector, mainly requires the <code>initContainer</code>
          to have <code>NET_ADMIN</code> capabilities.
        docs: reference/intercepts/#intercepting-headless-services

      - type: change
        title: Use one tunnel per connection instead of multiplexing into one tunnel
        body: >-
          We have changed Telepresence so that it uses one tunnel per connection instead
          of multiplexing all connections into one tunnel.  This will provide substantial
          performance improvements.  Clients will still be backwards compatible with older
          managers that only support multiplexing.

      - type: bugfix
        title: Added checks for Telepresence kubernetes compatibility
        body: >-
          Telepresence currently works with Kubernetes server versions <code>1.17.0</code>
          and higher.  We have added logs in the connector and <code>traffic-manager</code>
          to let users know when they are using Telepresence with a cluster it doesn't support.
        docs: reference/cluster-config

      - type: bugfix
        title: Traffic Agent security context is now only added when necessary
        body: >-
          When creating an intercept, Telepresence will now only set the traffic agent's GID
          when strictly necessary (i.e. when using headless services or numeric ports). This mitigates
          an issue on openshift clusters where the traffic agent can fail to be created due to
          openshift's security policies banning arbitrary GIDs.

  - version: 2.4.4
    date: "2021-09-27"
    notes:
      - type: feature
        title: Numeric ports in agent injector
        body: >-
          The agent injector now supports injecting Traffic Agents into pods that have unnamed ports.
        docs: reference/cluster-config/#note-on-numeric-ports

      - type: feature
        title: New subcommand to gather logs and export into zip file
        body: >-
          Telepresence has logs for various components (the <code>
          traffic-manager</code>, <code>traffic-agents</code>, the root and
          user daemons), which are integral for understanding and debugging
          Telepresence behavior.  We have added the <code>telepresence
          gather-logs</code> command to make it simple to compile logs for
          all Telepresence components and export them in a zip file that can
          be shared to others and/or included in a github issue. For more
          information on usage, run <code>telepresence gather-logs --help
          </code>.
        docs: reference/client
        image: telepresence-2.4.4-gather-logs.png

      - type: feature
        title: Pod CIDR strategy is configurable in Helm chart
        body: >-
          Telepresence now enables you to directly configure how to get
          pod CIDRs when deploying Telepresence with the Helm chart.
          The default behavior remains the same. We've also introduced
          the ability to explicitly set what the pod CIDRs should be.
        docs: install/helm

      - type: bugfix
        title: Compute pod CIDRs more efficiently
        body: >-
          When computing subnets using the pod CIDRs, the traffic-manager
          now uses less CPU cycles.
        docs: reference/routing/#subnets

      - type: bugfix
        title: Prevent busy loop in traffic-manager
        body: >-
          In some circumstances, the <code>traffic-manager</code>'s CPU
          would max out and get pinned at its limit. This required a
          shutdown or pod restart to fix. We've added some fixes
          to prevent the traffic-manager from getting into this state.

      - type: bugfix
        title: Added a fixed buffer size to TUN-device
        body: >-
          The TUN-device now has a max buffer size of 64K. This prevents the
          buffer from growing limitlessly until it receies a PSH, which could
          be a blocking operation when receiving lots of TCP-packets.
        docs: reference/tun-device

      - type: bugfix
        title: Fix hanging user daemon
        body: >-
          When Telepresence encountered an issue connecting to the cluster or
          the root daemon, it could hang indefintely. It now will error correctly
          when it encounters that situation.

      - type: bugfix
        title: Improved proprietary agent connectivity
        body: >-
          To determine whether the environment cluster is air-gapped, the
          proprietary agent attempts to connect to the cloud during startup.
          To deal with a possible initial failure, the agent backs off
          and retries the connection with an increasing backoff duration.

      - type: bugfix
        title: Telepresence correctly reports intercept port conflict
        body: >-
          When creating a second intercept targetting the same local port,
          it now gives the user an informative error message. Additionally,
          it tells them which intercept is currently using that port to make
          it easier to remedy.

  - version: 2.4.3
    date: "2021-09-15"
    notes:
      - type: feature
        title: Environment variable TELEPRESENCE_INTERCEPT_ID available in interceptor's environment
        body: >-
          When you perform an intercept, we now include a <code>TELEPRESENCE_INTERCEPT_ID</code> environment
          variable in the environment.
        docs: reference/environment/#telepresence-environment-variables

      - type: bugfix
        title: Improved daemon stability
        body: >-
          Fixed a timing bug that sometimes caused a "daemon did not start" failure.

      - type: bugfix
        title: Complete logs for Windows
        body: >-
          Crash stack traces and other errors were incorrectly not written to log files. This has
          been fixed so logs for Windows should be at parity with the ones in MacOS and Linux.

      - type: bugfix
        title: Log rotation fix for Linux kernel 4.11+
        body: >-
          On Linux kernel 4.11 and above, the log file rotation now properly reads the
          <code>birth-time</code> of the log file. Older kernels continue to use the old behavior
          of using the <code>change-time</code> in place of the <code>birth-time</code>.

      - type: bugfix
        title: Improved error messaging
        body: >-
          When Telepresence encounters an error, it tells the user where they should look for
          logs related to the error. We have refined this so that it only tells users to look
          for errors in the daemon logs for issues that are logged there.

      - type: bugfix
        title: Stop resolving localhost
        body: >-
          When using the overriding DNS resolver, it will no longer apply search paths when
          resolving <code>localhost</code>, since that should be resolved on the user's machine
          instead of the cluster.
        docs: reference/routing#linux-systemd-resolved-resolver

      - type: bugfix
        title: Variable cluster domain
        body: >-
          Previously, the cluster domain was hardcoded to <code>cluster.local</code>.  While this
          is true for many kubernetes clusters, it is not for all of them. Now this value is
          retrieved from the <code>traffic-manager</code>.

      - type: bugfix
        title: Improved cleanup of traffic-agents
        body: >-
          Telepresence now uninstalls <code>traffic-agents</code> installed via mutating webhook
          when using <code>telepresence uninstall --everything</code>.

      - type: bugfix
        title: More large file transfer fixes
        body: >-
          Downloading large files during an intercept will no longer cause timeouts and hanging
          <code>traffic-agents</code>.

      - type: bugfix
        title: Setting --mount to false when intercepting works as expected
        body: >-
          When using <code>--mount=false</code> while performing an intercept, the file system
          was still mounted.  This has been remedied so the intercept behavior respects the
          flag.
        docs: reference/volume

      - type: bugfix
        title: Traffic-manager establishes outbound connections in parallel
        body: >-
          Previously, the <code>traffic-manager</code> established outbound connections
          sequentially. This resulted in slow (and failing) <code>Dial</code> calls would
          block all outbound traffic from the workstation (for up to 30 seconds). We now
          establish these connections in parallel so that won't occur.
        docs: reference/routing/#outbound

      - type: bugfix
        title: Status command reports correct DNS settings
        body: >-
          <code>Telepresence status</code> now correctly reports DNS settings for all operating
          systems, instead of <code>Local IP:nil, Remote IP:nil</code> when they don't exist.

  - version: 2.4.2
    date: "2021-09-01"
    notes:
      - type: feature
        title: New subcommand to temporarily change log-level
        body: >-
          We have added a new <code>telepresence loglevel <level></code> subcommand that enables users
          to temporarily change the log-level for the local demons, the <code>traffic-manager</code> and
          the <code>traffic-agents</code>. While the <code>logLevels</code> settings from the config will
          still be used by default, this can be helpful if you are currently experiencing an issue and
          want to have higher fidelity logs, without doing a <code>telepresence quit</code> and
          <code>telepresence connect</code>. You can use <code>telepresence loglevel --help</code> to get
          more information on options for the command.
        docs: reference/config

      - type: change
        title: All components have info as the default log-level
        body: >-
          We've now set the default for all components of Telepresence (traffic-agent,
          traffic-manager, local daemons) to use <code>info</code> as the default log-level.

      - type: bugfix
        title: Updating RBAC in helm chart to fix cluster-id regression
        body: >-
          In 2.4.1, we enabled the <code>traffic-manager</code> to get the cluster ID by getting the UID
          of the default namespace. The helm chart was not updated to give the <code>traffic-manager</code>
          those permissions, which has since been fixed.  This impacted users who use licensed features of
          the Telepresence extension in an air-gapped environment.
        docs: reference/cluster-config/#air-gapped-cluster

      - type: bugfix
        title: Timeouts for Helm actions are now respected
        body: >-
          The user-defined timeout for Helm actions wasn't always respected, causing the daemon to hang
          indefinitely when failing to install the <code>traffic-manager</code>.
        docs: reference/config#timeouts

  - version: 2.4.1
    date: "2021-08-30"
    notes:
      - type: feature
        title: External cloud variables are now configurable
        body: >-
          We now support configuring the host and port for the cloud in your <code>config.yml</code>. These
          are used when logging in to utilize features provided by an extension, and are also passed
          along as environment variables when installing the <code>traffic-manager</code>. Additionally, we
          now run our testsuite with these variables set to localhost to continue to ensure Telepresence
          is fully fuctional without depeneding on an external service. The SYSTEMA_HOST and SYSTEMA_PORT
          environment variables are no longer used.
        image: telepresence-2.4.1-systema-vars.png
        docs: reference/config/#cloud

      - type: feature
        title: Helm chart can now regenerate certificate used for mutating webhook on-demand.
        body: >-
          You can now set <code>agentInjector.certificate.regenerate</code> when deploying Telepresence
          with the Helm chart to automatically regenerate the certificate used by the agent injector webhook.
        docs: install/helm

      - type: change
        title: Traffic Manager installed via helm
        body: >-
          The traffic-manager is now installed via an embedded version of the Helm chart when <code>telepresence connect</code> is first performed on a cluster.
          This change is transparent to the user.
          A new configuration flag, <code>timeouts.helm</code> sets the timeouts for all helm operations performed by the Telepresence binary.
        docs: reference/config#timeouts

      - type: change
        title: traffic-manager gets cluster ID itself instead of via environment variable
        body: >-
          The traffic-manager used to get the cluster ID as an environment variable when running
          <code>telepresence connnect</code> or via adding the value in the helm chart. This was
          clunky so now the traffic-manager gets the value itself as long as it has permissions
          to "get" and "list" namespaces (this has been updated in the helm chart).
        docs: install/helm

      - type: bugfix
        title: Telepresence now mounts all directories from /var/run/secrets
        body: >-
          In the past, we only mounted secret directories in <code>/var/run/secrets/kubernetes.io</code>.
          We now mount *all* directories in <code>/var/run/secrets</code>, which, for example, includes
          directories like <code>eks.amazonaws.com</code> used for IRSA tokens.
        docs: reference/volume

      - type: bugfix
        title: Max gRPC receive size correctly propagates to all grpc servers
        body: >-
          This fixes a bug where the max gRPC receive size was only propagated to some of the
          grpc servers, causing failures when the message size was over the default.
        docs: reference/config/#grpc

      - type: bugfix
        title: Updated our Homebrew packaging to run manually
        body: >-
          We made some updates to our script that packages Telepresence for Homebrew so that it
          can be run manually.  This will enable maintainers of Telepresence to run the script manually
          should we ever need to rollback a release and have <code>latest</code> point to an older verison.
        docs: install/

      - type: bugfix
        title: Telepresence uses namespace from kubeconfig context on each call
        body: >-
          In the past, Telepresence would use whatever namespace was specified in the kubeconfig's current-context
          for the entirety of the time a user was connected to Telepresence.  This would lead to confusing behavior
          when a user changed the context in their kubeconfig and expected Telepresence to acknowledge that change.
          Telepresence now will do that and use the namespace designated by the context on each call.

      - type: bugfix
        title: Idle outbound TCP connections timeout increased to 7200 seconds
        body: >-
          Some users were noticing that their intercepts would start failing after 60 seconds.
          This was because the keep idle outbound TCP connections were set to 60 seconds, which we have
          now bumped to 7200 seconds to match Linux's <code>tcp_keepalive_time</code> default.

      - type: bugfix
        title: Telepresence will automatically remove a socket upon ungraceful termination
        body: >-
          When a Telepresence process terminates ungracefully, it would inform users that "this usually means
          that the process has terminated ungracefully" and implied that they should remove the socket. We've
          now made it so Telepresence will automatically attempt to remove the socket upon ungraceful termination.

      - type: bugfix
        title: Fixed user daemon deadlock
        body: >-
          Remedied a situation where the user daemon could hang when a user was logged in.

      - type: bugfix
        title: Fixed agentImage config setting
        body: >-
          The config setting <code>images.agentImages</code> is no longer required to contain the repository, and it
          will use the value at <code>images.repository</code>.
        docs: reference/config/#images

  - version: 2.4.0
    date: "2021-08-04"
    notes:
      - type: feature
        title: Windows Client Developer Preview
        body: >-
          There is now a native Windows client for Telepresence that is being released as a Developer Preview.
          All the same features supported by the MacOS and Linux client are available on Windows.
        image: telepresence-2.4.0-windows.png
        docs: install

      - type: feature
        title: CLI raises helpful messages from Ambassador Cloud
        body: >-
          Telepresence can now receive messages from Ambassador Cloud and raise
          them to the user when they perform certain commands. This enables us
          to send you messages that may enhance your Telepresence experience when
          using certain commands. Frequency of messages can be configured in your
          <code>config.yml</code>.
        image: telepresence-2.4.0-cloud-messages.png
        docs: reference/config#cloud

      - type: bugfix
        title: Improved stability of systemd-resolved-based DNS
        body: >-
          When initializing the <code>systemd-resolved</code>-based DNS, the routing domain
          is set to improve stability in non-standard configurations. This also enables the
          overriding resolver to do a proper take over once the DNS service ends.
        docs: reference/routing#linux-systemd-resolved-resolver

      - type: bugfix
        title: Fixed an edge case when intercepting a container with multiple ports
        body: >-
          When specifying a port of a container to intercept, if there was a container in the
          pod without ports, it was automatically selected. This has been fixed so we'll only
          choose the container with "no ports" if there's no container that explicitly matches
          the port used in your intercept.
        docs: reference/intercepts/#creating-an-intercept-when-a-service-has-multiple-ports

      - type: bugfix
        title: $(NAME) references in agent's environments are now interpolated correctly.
        body: >-
          If you had an environment variable $(NAME) in your workload that referenced another, intercepts
          would not correctly interpolate $(NAME). This has been fixed and works automatically.

      - type: bugfix
        title: Telepresence no longer prints INFO message when there is no config.yml
        body: >-
          Fixed a regression that printed an INFO message to the terminal when there wasn't a
          <code>config.yml</code> present.  The config is optional, so this message has been
          removed.
        docs: reference/config

      - type: bugfix
        title: Telepresence no longer panics when using --http-match
        body: >-
          Fixed a bug where Telepresence would panic if the value passed to <code>--http-match</code>
          didn't contain an equal sign, which has been fixed. The correct syntax is in the <code>--help</code>
          string and looks like <code>--http-match=HTTP2_HEADER=REGEX</code>
        docs: reference/intercepts/#intercept-behavior-when-logged-in-to-ambassador-cloud

      - type: bugfix
        title: Improved subnet updates
        body: >-
          The <code>traffic-manager</code> used to update subnets whenever the <code>Nodes</code> or <code>Pods</code> changed, even if
          the underlying subnet hadn't changed, which created a lot of unnecessary traffic between the
          client and the <code>traffic-manager</code>.  This has been fixed so we only send updates when the subnets
          themselves actually change.
        docs: reference/routing/#subnets

  - version: 2.3.7
    date: "2021-07-23"
    notes:
      - type: feature
        title: Also-proxy in telepresence status
        body: >-
          An <code>also-proxy</code> entry in the Kubernetes cluster config will
          show up in the output of the <code>telepresence status</code> command.
        docs: reference/config

      - type: feature
        title: Non-interactive telepresence login
        body: >-
          <code>telepresence login</code> now has an
          <code>--apikey=KEY</code> flag that allows for
          non-interactive logins.  This is useful for headless
          environments where launching a web-browser is impossible,
          such as cloud shells, Docker containers, or CI.
        image: telepresence-2.3.7-newkey.png
        docs: reference/client/login/

      - type: bugfix
        title: Mutating webhook injector correctly hides named ports for probes.
        body: >-
          The mutating webhook injector has been fixed to correctly rename named ports for liveness and readiness probes
        docs: reference/cluster-config

      - type: bugfix
        title: telepresence current-cluster-id crash fixed
        body: >-
          Fixed a regression introduced in 2.3.5 that caused <code>telepresence current-cluster-id</code>
          to crash.
        docs: reference/cluster-config

      - type: bugfix
        title: Better UX around intercepts with no local process running
        body: >-
          Requests would hang indefinitely when initiating an intercept before you
          had a local process running. This has been fixed and will result in an
          <code>Empty reply from server</code> until you start a local process.
        docs: reference/intercepts

      - type: bugfix
        title: API keys no longer show as "no description"
        body: >-
          New API keys generated internally for communication with
          Ambassador Cloud no longer show up as "no description" in
          the Ambassador Cloud web UI.  Existing API keys generated by
          older versions of Telepresence will still show up this way.
        image: telepresence-2.3.7-keydesc.png

      - type: bugfix
        title: Fix corruption of user-info.json
        body: >-
          Fixed a race condition that logging in and logging out
          rapidly could cause memory corruption or corruption of the
          <code>user-info.json</code> cache file used when
          authenticating with Ambassador Cloud.

      - type: bugfix
        title: Improved DNS resolver for systemd-resolved
        body:
          Telepresence's <code>systemd-resolved</code>-based DNS resolver is now more
          stable and in case it fails to initialize, the <code>overriding resolver</code>
          will no longer cause general DNS lookup failures when telepresence defaults to
          using it.
        docs: reference/routing#linux-systemd-resolved-resolver

      - type: bugfix
        title: Faster telepresence list command
        body:
          The performance of <code>telepresence list</code> has been increased
          significantly by reducing the number of calls the command makes to the cluster.
        docs: reference/client

  - version: 2.3.6
    date: "2021-07-20"
    notes:
      - type: bugfix
        title: Fix preview URLs
        body: >-
          Fixed a regression introduced in 2.3.5 that caused preview
          URLs to not work.

      - type: bugfix
        title: Fix subnet discovery
        body: >-
          Fixed a regression introduced in 2.3.5 where the Traffic
          Manager's <code>RoleBinding</code> did not correctly appoint
          the <code>traffic-manager</code> <code>Role</code>, causing
          subnet discovery to not be able to work correctly.
        docs: reference/rbac/

      - type: bugfix
        title: Fix root-user configuration loading
        body: >-
          Fixed a regression introduced in 2.3.5 where the root daemon
          did not correctly read the configuration file; ignoring the
          user's configured log levels and timeouts.
        docs: reference/config/

      - type: bugfix
        title: Fix a user daemon crash
        body: >-
          Fixed an issue that could cause the user daemon to crash
          during shutdown, as during shutdown it unconditionally
          attempted to close a channel even though the channel might
          already be closed.

  - version: 2.3.5
    date: "2021-07-15"
    notes:
      - type: feature
        title: traffic-manager in multiple namespaces
        body: >-
          We now support installing multiple traffic managers in the same cluster.
          This will allow operators to install deployments of telepresence that are
          limited to certain namespaces.
        image: ./telepresence-2.3.5-traffic-manager-namespaces.png
        docs: install/helm
      - type: feature
        title: No more dependence on kubectl
        body: >-
          Telepresence no longer depends on having an external
          <code>kubectl</code> binary, which might not be present for
          OpenShift users (who have <code>oc</code> instead of
          <code>kubectl</code>).
      - type: feature
        title: Agent image now configurable
        body: >-
          We now support configuring which agent image + registry to use in the
          config. This enables users whose laptop is an air-gapped environment to
          create personal intercepts without requiring a login. It also makes it easier
          for those who are developing on Telepresence to specify which agent image should
          be used. Env vars TELEPRESENCE_AGENT_IMAGE and TELEPRESENCE_REGISTRY are no longer
          used.
        image: ./telepresence-2.3.5-agent-config.png
        docs: reference/config/#images
      - type: feature
        title: Max gRPC receive size now configurable
        body: >-
          The default max size of messages received through gRPC (4 MB) is sometimes insufficient. It can now be configured.
        image: ./telepresence-2.3.5-grpc-max-receive-size.png
        docs: reference/config/#grpc
      - type: feature
        title: CLI can be used in air-gapped environments
        body: >-
          While Telepresence will auto-detect if your cluster is in an air-gapped environment,
          we've added an option users can add to their config.yml to ensure the cli acts like it
          is in an air-gapped environment. Air-gapped environments require a manually installed
          licence.
        docs: reference/cluster-config/#air-gapped-cluster
        image: ./telepresence-2.3.5-skipLogin.png
  - version: 2.3.4
    date: "2021-07-09"
    notes:
      - type: bugfix
        title: Improved IP log statements
        body: >-
          Some log statements were printing incorrect characters, when they should have been IP addresses.
          This has been resolved to include more accurate and useful logging.
        docs: reference/config/#log-levels
        image: ./telepresence-2.3.4-ip-error.png
      - type: bugfix
        title: Improved messaging when multiple services match a workload
        body: >-
          If multiple services matched a workload when performing an intercept, Telepresence would crash.
          It now gives the correct error message, instructing the user on how to specify which
          service the intercept should use.
        image: ./telepresence-2.3.4-improved-error.png
        docs: reference/intercepts
      - type: bugfix
        title: Traffic-manger creates services in its own namespace to determine subnet
        body: >-
          Telepresence will now determine the service subnet by creating a dummy-service in its own
          namespace, instead of the default namespace, which was causing RBAC permissions issues in
          some clusters.
        docs: reference/routing/#subnets
      - type: bugfix
        title: Telepresence connect respects pre-existing clusterrole
        body: >-
          When Telepresence connects, if the <code>traffic-manager</code>'s desired <code>clusterrole</code> already exists in the
          cluster, Telepresence will no longer try to update the clusterrole.
        docs: reference/rbac
      - type: bugfix
        title: Helm Chart fixed for clientRbac.namespaced
        body: >-
          The Telepresence Helm chart no longer fails when installing with <code>--set clientRbac.namespaced=true</code>.
        docs: install/helm
  - version: 2.3.3
    date: "2021-07-07"
    notes:
      - type: feature
        title: Traffic Manager Helm Chart
        body: >-
          Telepresence now supports installing the Traffic Manager via Helm.
          This will make it easy for operators to install and configure the
          server-side components of Telepresence separately from the CLI (which
          in turn allows for better separation of permissions).
        image: ./telepresence-2.3.3-helm.png
        docs: install/helm/
      - type: feature
        title: Traffic-manager in custom namespace
        body: >-
          As the <code>traffic-manager</code> can now be installed in any
          namespace via Helm, Telepresence can now be configured to look for the
          Traffic Manager in a namespace other than <code>ambassador</code>.
          This can be configured on a per-cluster basis.
        image: ./telepresence-2.3.3-namespace-config.png
        docs: reference/config
      - type: feature
        title: Intercept --to-pod
        body: >-
          <code>telepresence intercept</code> now supports a
          <code>--to-pod</code> flag that can be used to port-forward sidecars'
          ports from an intercepted pod.
        image: ./telepresence-2.3.3-to-pod.png
        docs: reference/intercepts
      - type: change
        title: Change in migration from edgectl
        body: >-
          Telepresence no longer automatically shuts down the old
          <code>api_version=1</code> <code>edgectl</code> daemon.  If migrating
          from such an old version of <code>edgectl</code> you must now manually
          shut down the <code>edgectl</code> daemon before running Telepresence.
          This was already the case when migrating from the newer
          <code>api_version=2</code> <code>edgectl</code>.
      - type: bugfix
        title: Fixed error during shutdown
        body: >-
          The root daemon no longer terminates when the user daemon disconnects
          from its gRPC streams, and instead waits to be terminated by the CLI.
          This could cause problems with things not being cleaned up correctly.
      - type: bugfix
        title: Intercepts will survive deletion of intercepted pod
        body: >-
          An intercept will survive deletion of the intercepted pod provided
          that another pod is created (or already exists) that can take over.
  - version: 2.3.2
    date: "2021-06-18"
    notes:
      # Headliners
      - type: feature
        title: Service Port Annotation
        body: >-
          The mutator webhook for injecting traffic-agents now
          recognizes a
          <code>telepresence.getambassador.io/inject-service-port</code>
          annotation to specify which port to intercept; bringing the
          functionality of the <code>--port</code> flag to users who
          use the mutator webook in order to control Telepresence via
          GitOps.
        image: ./telepresence-2.3.2-svcport-annotation.png
        docs: reference/cluster-config#service-port-annotation
      - type: feature
        title: Outbound Connections
        body: >-
          Outbound connections are now routed through the intercepted
          Pods which means that the connections originate from that
          Pod from the cluster's perspective.  This allows service
          meshes to correctly identify the traffic.
        docs: reference/routing/#outbound
      - type: change
        title: Inbound Connections
        body: >-
          Inbound connections from an intercepted agent are now
          tunneled to the manager over the existing gRPC connection,
          instead of establishing a new connection to the manager for
          each inbound connection.  This avoids interference from
          certain service mesh configurations.
        docs: reference/routing/#inbound

      # RBAC changes
      - type: change
        title: Traffic Manager needs new RBAC permissions
        body: >-
          The Traffic Manager requires <a href="../reference/rbac">RBAC
          permissions</a> to list Nodes, Pods, and to create a dummy
          Service in the manager's namespace.
        docs: reference/routing/#subnets
      - type: change
        title: Reduced developer RBAC requirements
        body: >-
          The on-laptop client no longer requires <a
          href="../reference/rbac">RBAC permissions</a> to list the Nodes
          in the cluster or to create Services, as that functionality
          has been moved to the Traffic Manager.

      # Bugfixes
      - type: bugfix
        title: Able to detect subnets
        body: >-
          Telepresence will now detect the Pod CIDR ranges even if
          they are not listed in the Nodes.
        image: ./telepresence-2.3.2-subnets.png
        docs: reference/routing/#subnets
      - type: bugfix
        title: Dynamic IP ranges
        body: >-
          The list of cluster subnets that the virtual network
          interface will route is now configured dynamically and will
          follow changes in the cluster.
      - type: bugfix
        title: No duplicate subnets
        body: >-
          Subnets fully covered by other subnets are now pruned
          internally and thus never superfluously added to the
          laptop's routing table.
        docs: reference/routing/#subnets
      - type: change # not a bugfix, but it only makes sense to mention after the above bugfixes
        title: Change in default timeout
        body: >-
          The <code>trafficManagerAPI</code> timeout default has
          changed from 5 seconds to 15 seconds, in order to facilitate
          the extended time it takes for the traffic-manager to do its
          initial discovery of cluster info as a result of the above
          bugfixes.
      - type: bugfix
        title: Removal of DNS config files on macOS
        body: >-
          On macOS, files generated under
          <code>/etc/resolver/</code> as the result of using
          <code>include-suffixes</code> in the cluster config are now
          properly removed on quit.
        docs: reference/routing/#macos-resolver

      - type: bugfix
        title: Large file transfers
        body: >-
          Telepresence no longer erroneously terminates connections
          early when sending a large HTTP response from an intercepted
          service.
      - type: bugfix
        title: Race condition in shutdown
        body: >-
          When shutting down the user-daemon or root-daemon on the
          laptop, <code>telepresence quit</code> and related commands
          no longer return early before everything is fully shut down.
          Now it can be counted on that by the time the command has
          returned that all of the side-effects on the laptop have
          been cleaned up.
  - version: 2.3.1
    date: "2021-06-14"
    notes:
      - title: DNS Resolver Configuration
        body: "Telepresence now supports per-cluster configuration for custom dns behavior, which will enable users to determine which local + remote resolver to use and which suffixes should be ignored + included. These can be configured on a per-cluster basis."
        image: ./telepresence-2.3.1-dns.png
        docs: reference/config
        type: feature
      - title: AlsoProxy Configuration
        body: "Telepresence now supports also proxying user-specified subnets so that they can access external services only accessible to the cluster while connected to Telepresence. These can be configured on a per-cluster basis and each subnet is added to the TUN device so that requests are routed to the cluster for IPs that fall within that subnet."
        image: ./telepresence-2.3.1-alsoProxy.png
        docs: reference/config
        type: feature
      - title: Mutating Webhook for Injecting Traffic Agents
        body: "The Traffic Manager now contains a mutating webhook to automatically add an agent to pods that have the <code>telepresence.getambassador.io/traffic-agent: enabled</code> annotation.  This enables Telepresence to work well with GitOps CD platforms that rely on higher level kubernetes objects matching what is stored in git.  For workloads without the annotation, Telepresence will add the agent the way it has in the past"
        image: ./telepresence-2.3.1-inject.png
        docs: reference/rbac
        type: feature
      - title: Traffic Manager Connect Timeout
        body: "The trafficManagerConnect timeout default has changed from 20 seconds to 60 seconds, in order to facilitate the extended time it takes to apply everything needed for the mutator webhook."
        image: ./telepresence-2.3.1-trafficmanagerconnect.png
        docs: reference/config
        type: change
      - title: Fix for large file transfers
        body: "Fix a tun-device bug where sometimes large transfers from services on the cluster would hang indefinitely"
        image: ./telepresence-2.3.1-large-file-transfer.png
        docs: reference/tun-device
        type: bugfix
      - title: Brew Formula Changed
        body: "Now that the Telepresence rewrite is the main version of Telepresence, you can install it via Brew like so: <code>brew install datawire/blackbird/telepresence</code>."
        image: ./telepresence-2.3.1-brew.png
        docs: install/
        type: change
  - version: 2.3.0
    date: "2021-06-01"
    notes:
      - title: Brew install Telepresence
        body: "Telepresence can now be installed via brew on macOS, which makes it easier for users to stay up-to-date with the latest telepresence version. To install via brew, you can use the following command: <code>brew install datawire/blackbird/telepresence2</code>."
        image: ./telepresence-2.3.0-homebrew.png
        docs: install/
        type: feature
      - title: TCP and UDP routing via Virtual Network Interface
        body: "Telepresence will now perform routing of outbound TCP and UDP traffic via a Virtual Network Interface (VIF). The VIF is a layer 3 TUN-device that exists while Telepresence is connected. It makes the subnets in the cluster available to the workstation and will also route DNS requests to the cluster and forward them to intercepted pods. This means that pods with custom DNS configuration will work as expected. Prior versions of Telepresence would use firewall rules and were only capable of routing TCP."
        image: ./tunnel.jpg
        docs: reference/tun-device
        type: feature
      - title: SSH is no longer used
        body: "All traffic between the client and the cluster is now tunneled via the traffic manager gRPC API. This means that Telepresence no longer uses ssh tunnels and that the manager no longer have an <code>sshd</code> installed. Volume mounts are still established using <code>sshfs</code> but it is now configured to communicate using the sftp-protocol directly, which means that the traffic agent also runs without <code>sshd</code>. A desired side effect of this is that the manager and agent containers no longer need a special user configuration."
        image: ./no-ssh.png
        docs: reference/tun-device/#no-ssh-required
        type: change
      - title: Running in a Docker container
        body: "Telepresence can now be run inside a Docker container. This can be useful for avoiding side effects on a workstation's network, establishing multiple sessions with the traffic manager, or working with different clusters simultaneously."
        image: ./run-tp-in-docker.png
        docs: reference/inside-container
        type: feature
      - title: Configurable Log Levels
        body: "Telepresence now supports configuring the log level for Root Daemon and User Daemon logs. This provides control over the nature and volume of information that Telepresence generates in <code>daemon.log</code> and <code>connector.log</code>."
        image: ./telepresence-2.3.0-loglevels.png
        docs: reference/config/#log-levels
        type: feature
  - version: 2.2.2
    date: "2021-05-17"
    notes:
      - title: Legacy Telepresence subcommands
        body: Telepresence is now able to translate common legacy Telepresence commands into native Telepresence commands. So if you want to get started quickly, you can just use the same legacy Telepresence commands you are used to with the new Telepresence binary.
        image: ./telepresence-2.2.png
        docs: install/migrate-from-legacy/
        type: feature
